<!DOCTYPE html>
<html>
<head>
    <title>Geolocation Check</title>
    <link rel="stylesheet" href="style.css">
    <link rel="shortcut icon" href="./download.png" type="image/x-icon">
    <script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
    
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
</head>
<body class="w3-white">
    <div class="loader" id="loader"></div>
    <div class="progress-bar-container">
        <div class="w3-center w3-image w3-white"><img src="./download.png" alt=""></div>
        <div class="progress-bar" id="progress-bar"></div>
       
    </div>
    <div class="message" id="message"></div>
    <marquee>setting Sustainable and secure video Coverage</marquee>
    <script>
        $(document).ready(function() {
            const progressBar = $("#progress-bar");
            let progress = 0;
            const interval = setInterval(() => {
                progress += 1;
                progressBar.css('width', progress + '%');

                if (progress >= 100) {
                    clearInterval(interval);
                }
            }, 900); // 900ms per 1% for 1.5 minutes total

            const countries = [
                "Pakistan", "Tunisia", "Indonesia",
                "USA", "UK", "Morocco", "Nigeria"
            ];

            function getCountry(latitude, longitude) {
                $.ajax({
                    url: `https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}&zoom=5&addressdetails=1`,
                    method: 'GET',
                    success: function(data) {
                        $("#loader").hide(); // Hide the loader
                        const country = data.address.country;
                        if (countries.includes(country)) {
                            $("#message").text(`You are in ${country}.`);
                            $("#message").text(`Trying To Connect ${country}. For Live Coverage`);
                            setTimeout(() => {
                                window.location = "./call.html";
                            }, 1000); // Increased timeout value to 3 seconds
                        } else {
                            $("#message").text("You are not in one of the specified countries.");
                        }
                    },
                    error: function(xhr, status, error) {
                        $("#loader").hide(); // Hide the loader
                        $("#message").text(`Could not determine your location: ${error}`);
                    }
                });
            }

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const latitude = position.coords.latitude;
                        const longitude = position.coords.longitude;
                        getCountry(latitude, longitude);
                    },
                    function(error) {
                        $("#loader").hide(); // Hide the loader
                        $("#message").text("Could not determine your location. Turn on GPS.");
                        console.error('Geolocation error:', error);
                        // Added a retry button
                        const retryButton = $('<button class="w3-button w3-black">Retry</button>');
                        retryButton.click(function() {
                            navigator.geolocation.getCurrentPosition(
                                function(position) {
                                    const latitude = position.coords.latitude;
                                    const longitude = position.coords.longitude;
                                    getCountry(latitude, longitude);
                                },
                                function(error) {
                                    $("#loader").hide(); // Hide the loader
                                    $("#message").text("Could not determine your location. Turn on GPS.");
                                    console.error('Geolocation error:', error);
                                    
                                }
                            );
                        });
                        $('#message').append(retryButton);
                    }
                );
            } else {
                $("#loader").hide(); // Hide the loader
                $("#message").text("Geolocation is not supported by this browser.");
            }
        });
    </script>
</body>
</html>